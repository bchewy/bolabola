name: Docker Compose Check

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2
      - name: Docker compose pull
        run: docker compose pull
      # - name: Docker Compose Action
      #   uses: isbang/compose-action@v1.5.1
      - name: Docker Compose Action
        uses: alexkainzinger/compose-action@v2 # using node20 see: https://github.com/isbang/compose-action/pull/37
        with:
          compose-file: |
            docker-compose.yml
        env:
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          AWS_DEFAULT_REGION: ${{ secrets.AWS_DEFAULT_REGION }}
      - name: Validate Docker Compose file
        run: docker compose config
